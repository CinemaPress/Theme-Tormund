<!DOCTYPE html>
<html lang="<%- page.language %>"
      prefix="og: http://ogp.me/ns# video: http://ogp.me/ns/video# ya: http://webmaster.yandex.ru/vocabularies/">

<head>
    <%- include('includes/head.ejs'); -%>
</head>

<body class="fluid">

<% /* Брендирование страницы (сразу после <body>) */ %>
<% if (typeof page.adv === 'object' && page.adv.brand) { %>
    <%- page.adv.brand %>
<% } %>

<div data-gets="" data-type="pgskin"></div>
<main id="wrapper">
    <header id="header">
        <%- include('includes/header.ejs'); -%>
    </header>
    <div id="wrapper-inner">
        <div class="triggered-overlay"></div>

        <%- include('includes/menu.ejs'); -%>

        <div id="content">
            <% /* Реклама вверху страницы */ %>
            <% if (typeof page.adv === 'object' && page.adv.top) { %>
                <div style="text-align:center;margin:10px auto">
                    <%- page.adv.top %>
                </div>
            <% } %>
            <div class="inner-content container">
                <div id="router-view">
                    <div data-gets="" data-type="uyari"></div>
                    <div data-gets="" data-type="hdr"></div>
                    <% /* Слайдер с фильмами */ %>
                    <% if (typeof slider === 'object' && slider.length) { %>
                        <div class="featured-segment">
                            <div class="flex flex-row">
                                <div class="flex flex-column">
                                    <h2 class="segment-title"><%- page.l.series %></h2>
                                    <div class="flex flex-row">
                                        <% slider.slice(0, 1).forEach(function (movie) { %>
                                            <div class="flex flex-column poster poster-hg">
                                                <div class="flex poster-media">
                                                    <a href="<%- movie.url %>" title="<%= movie.title %>">
                                                        <div class="poster-subject">
                                                            <span class="date">
                                                                <date class="today"><%- movie.year %></date>
                                                            </span>
                                                            <figure class="poster-img">
                                                                <img src="<%- movie.poster_min %>" class="lazy" data-src="<%- movie.poster %>" alt="<%- movie.title %>">
                                                            </figure>
                                                            <h2 class="truncate"><%- movie.title %></h2>
                                                            <p class="poster-meta truncate">
                                                                <span class="episode-no"><%- movie.genres %></span>
                                                            </p>
                                                        </div>
                                                        <img class="lazy-wide"
                                                             src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAQAAACRI2S5AAAAEElEQVR42mNkIAAYRxWAAQAG9gAKqv6+AwAAAABJRU5ErkJggg=="
                                                             alt="<%- movie.title %>" data-src="<%- movie.picture_big %>">
                                                    </a>
                                                </div>
                                            </div>
                                        <% }); %>
                                    </div>
                                    <div class="flex flex-row">
                                        <% slider.slice(1, 3).forEach(function (movie) { %>
                                            <div class="flex poster poster-sm">
                                                <div class="poster-media">
                                                    <a href="<%- movie.url %>" title="<%= movie.title %>">
                                                        <div class="poster-subject">
                                                            <span class="date">
                                                                <date><%- movie.year %></date>
                                                            </span>
                                                            <h2 class="truncate"><%- movie.title %></h2>
                                                            <p class="poster-meta truncate">
                                                                <span class="episode-no"><%- movie.genres %></span>
                                                            </p>
                                                        </div>
                                                        <img class="lazy-wide"
                                                             src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAQAAACRI2S5AAAAEElEQVR42mNkIAAYRxWAAQAG9gAKqv6+AwAAAABJRU5ErkJggg=="
                                                             alt="<%= movie.title %>" data-src="<%- movie.picture_big %>">
                                                    </a>
                                                </div>
                                            </div>
                                        <% }); %>
                                    </div>
                                </div>
                                <div data-gets="" data-type="ho" class="mobile-only"></div>
                                <div class="flex flex-column">
                                    <h2 class="segment-title"><%- page.l.movies %></h2>
                                    <div class="flex flex-row">
                                        <% slider.slice(3, 5).forEach(function (movie) { %>
                                            <div class="flex poster poster-sm">
                                                <div class="poster-media">
                                                    <a href="<%- movie.url %>" title="<%= movie.title %>">
                                                        <div class="poster-subject">
                                                            <span class="date">
                                                                <date><%- movie.year %></date>
                                                            </span>
                                                            <h2 class="truncate"><%- movie.title %></h2>
                                                            <p class="poster-meta truncate">
                                                                <span class="episode-no"><%- movie.genres %></span>
                                                            </p>
                                                        </div>
                                                        <img class="lazy-wide"
                                                             src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAQAAACRI2S5AAAAEElEQVR42mNkIAAYRxWAAQAG9gAKqv6+AwAAAABJRU5ErkJggg=="
                                                             alt="<%= movie.title %>" data-src="<%- movie.picture_big %>">
                                                    </a>
                                                </div>
                                            </div>
                                        <% }); %>
                                    </div>
                                    <div class="flex flex-row">
                                        <% slider.slice(5, 6).forEach(function (movie) { %>
                                            <div class="flex flex-column poster poster-hg">
                                                <div class="flex poster-media">
                                                    <a href="<%- movie.url %>" title="<%= movie.title %>">
                                                        <div class="poster-subject">
                                                            <span class="date">
                                                                <date class="today"><%- movie.year %></date>
                                                            </span>
                                                            <figure class="poster-img">
                                                                <img src="<%- movie.poster_min %>" class="lazy" data-src="<%- movie.poster %>" alt="<%- movie.title %>">
                                                            </figure>
                                                            <h2 class="truncate"><%- movie.title %></h2>
                                                            <p class="poster-meta truncate">
                                                                <span class="episode-no"><%- movie.genres %></span>
                                                            </p>
                                                        </div>
                                                        <img class="lazy-wide"
                                                             src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAQAAACRI2S5AAAAEElEQVR42mNkIAAYRxWAAQAG9gAKqv6+AwAAAABJRU5ErkJggg=="
                                                             alt="<%= movie.title %>" data-src="<%- movie.picture_big %>">
                                                    </a>
                                                </div>
                                            </div>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% } %>
                    <div data-gets="" data-type="ssf"></div>
                    <% /* Блок серий на главной странице */ %>
                    <% if (typeof index === 'object') { %>
                        <div class="dark-segment">
                            <% for (var type in index) { %>
                                <% if (index.hasOwnProperty(type) && index[type].length && type === 'episode') { %>
                                    <% index[type].forEach(function (category) { %>

                                        <% /* Название блока */ %>
                                        <div class="segment-title pt-lg"><%- category.name %></div>

                                        <% /* Цикл серий в блоке */ %>
                                        <% var moreEpisodes = false; %>
                                        <% if (typeof category === 'object' && category.movies && category.movies.length) { %>
                                            <ul class="clearfix" id="result_lastEpisodes">
                                                <% category.movies.forEach(function (movie) { %>
                                                    <% /* Выводим ограниченное число серий, остальные скрываем */ %>
                                                    <li class="segment-poster-sm"
                                                        <% if (movie.hide) { moreEpisodes = true; %>style="display:none"
                                                        data-more-episodes
                                                            <% } %>
                                                    >
                                                        <div class="poster poster-xs">
                                                            <a href="<%- movie.url %>">
                                                                <span class="date">
                                                                    <date class="today"><%- movie.year %></date>
                                                                </span>
                                                                <div class="poster-subject">
                                                                    <h2 class="truncate"><%- movie.title %></h2>
                                                                    <p class="poster-meta">
                                                                        <% if (movie.season && movie.episode) { %>
                                                                            <span class="episode-no"><%- movie.season %> <%- page.l.season %>
                                                                                · <%- movie.episode %> <%- page.l.episode %></span>
                                                                        <% } %>
                                                                        <% if (movie.translate) { %>
                                                                            <% /* Озвучка */ %>
                                                                            <span class="episode-ses">
                                                                                <i class="mofylag grey en"
                                                                                   data-tooltip="<%- movie.translate %>"
                                                                                   data-inverted=""></i>
                                                                            </span>
                                                                        <% } %>
                                                                    </p>
                                                                </div>
                                                                <img class="lazy-wide" alt="<%= movie.title %>"
                                                                     src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAQAAACRI2S5AAAAEElEQVR42mNkIAAYRxWAAQAG9gAKqv6+AwAAAABJRU5ErkJggg=="
                                                                     data-src="<%- movie.poster_min %>">
                                                            </a>
                                                        </div>
                                                    </li>
                                                <% }); %>
                                            </ul>
                                        <% } %>

                                        <% /* Выводим кнопку для показа большего числа серий */ %>
                                        <% if (moreEpisodes) { %>
                                            <button type="button"
                                                    class="ui button load-more series-load-more moreEpisodes"
                                                    onclick="var dme = document.querySelectorAll('[data-more-episodes]'); dme && dme.forEach(function(e) {e.style.display='inline-block'});this.style.display='none'">
                                                <svg class="mofycon">
                                                    <use xlink:href="#icon-plus"></use>
                                                </svg> <%- page.l.moreEpisodes %></button>
                                        <% } %>

                                    <% }); %>
                                <% } %>
                            <% } %>
                        </div>
                    <% } %>
                    <% /* Цикл блоков фильмов на главной странице */ %>
                    <% if (typeof index === 'object') { %>
                        <% var i_category = 0; %>
                        <% for (var type in index) { %>
                            <% if (index.hasOwnProperty(type) && index[type].length && type !== 'episode') { %>
                                <% index[type].forEach(function (category) { %>

                                    <div class="ui grid mt-0 mb-0">
                                        <div class="left floated sixteen wide tablet <% if (i_category === 0) { %>eleven<% } else { %>sixteen<% } %> wide computer column pt-0 pb-0">
                                            <div class="dark-segment">

                                                <% /* Название блока */ %>
                                                <h2 class="segment-title">
                                                    <%- category.name %>
                                                    <% /* Справа от названия ссылка на случайный фильм из блока */ %>
                                                    <div class="randomMovieIndex">
                                                        <div class="cinemapress-random-index"
                                                             onclick="window.location.href='<%- category.url %>?random'"
                                                             title="<%- page.l.random %>">
                                                            <img src="/themes/<%- page.theme %>/public/images/dice.svg"
                                                                 alt="<%- page.l.random %>">
                                                        </div>
                                                    </div>
                                                </h2>

                                                <% /* Цикл фильмов в блоке */ %>
                                                <% if (typeof category === 'object' && category.movies && category.movies.length) { %>
                                                    <ul class="flex flex-wrap flex-home">
                                                        <% category.movies.forEach(function (movie) { %>

                                                            <li class="mofy-moviesli <% if (i_category !== 0) { %>mofy-moviesli-15<% } %>">
                                                                <div class="mofy-movbox">
                                                                    <div class="mofy-movbox-image relative">
                                                                        <a href="<%- movie.url %>"
                                                                           title="<%= movie.title %>">
                                                                            <img class="lazy-wide"
                                                                                 src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAADCAQAAAAT4xYKAAAADklEQVR42mNkAAJGOAEAAC0ABNxMS2YAAAAASUVORK5CYII="
                                                                                 alt="<%= movie.title %>"
                                                                                 data-src="<%- movie.poster %>">
                                                                            <div class="mofy-movbox-on absolute">
                                                                                <div class="mofytrend absolute">
                                                                                    <svg viewBox="0 0 21.16 27.34"
                                                                                         class="mofysymbol">
                                                                                        <g id="Layer_2"
                                                                                           data-name="Layer 2">
                                                                                            <g id="katman_1"
                                                                                               data-name="katman 1">
                                                                                                <path class="cls-1"
                                                                                                      d="M0,27.26l.1.08L18.39,16.55c-.24-.33-.38-.54-.54-.73-1.12-1.35-2.2-2.72-3.38-4A1.21,1.21,0,0,1,14.35,10C16.46,7,18.5,3.94,20.57.91c.17-.24.32-.49.59-.91L2.66,10.91c.19.27.33.49.49.68C4.33,13,5.48,14.42,6.7,15.8a1,1,0,0,1,.09,1.53C4.5,20.62,2.26,24,0,27.26Z"></path>
                                                                                            </g>
                                                                                        </g>
                                                                                    </svg>
                                                                                    <div class="mofytrend-text absolute text-center">
                                                                                        <span class="block">HIT</span>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="mofy-movsound flex justify-end">
                                                                                    <% if (movie.translate) { %>
                                                                                        <i class="mofylag grey en"
                                                                                           data-tooltip="<%- movie.translate %>"
                                                                                           data-inverted=""></i>
                                                                                    <% } %>
                                                                                </div>
                                                                                <div class="mofy-movpoint flex items-center justify-between absolute">
                                                                                    <% if (movie.vote) { %>
                                                                                        <span class="flex items-center">
                                                                                            <svg>
                                                                                                <path d="M12.3 4.1l-3.5-.5-1.6-3.2c-.2-.5-1.2-.5-1.4 0l-1.6 3.2-3.5.5c-.7.1-.9.9-.5 1.4l2.6 2.5-.6 3.5c-.1.7.6 1.2 1.2.9l3.1-1.6 3.1 1.6c.6.3 1.3-.2 1.2-.9l-.6-3.5 2.5-2.5c.5-.5.3-1.3-.4-1.4z"></path>
                                                                                            </svg>
                                                                                            <%- movie.rating / 10 %>
                                                                                        </span>
                                                                                    <% } %>
                                                                                    <p><%- movie.year %></p>
                                                                                </div>
                                                                            </div>
                                                                        </a>
                                                                    </div>
                                                                    <div class="mofy-movbox-text">
                                                                        <span class="block">
                                                                            <a href="<%- movie.url %>"
                                                                               class="block truncate">
                                                                                <%- movie.title %>
                                                                            </a>
                                                                        </span>
                                                                        <p class="truncate"><%- movie.genres %></p>
                                                                    </div>
                                                                </div>
                                                            </li>

                                                        <% }); %>
                                                    </ul>
                                                <% } %>

                                            </div>
                                        </div>

                                        <% if (i_category === 0) { i_category = i_category + 1; %>
                                        <% /* Блок с последними комментариями пользователей */ %>
                                        <% if (typeof recent === 'object' && recent.length) { %>
                                            <div class="right floated sixteen wide tablet five wide computer column pt-0 pb-0">
                                                <div class="dark-segment">
                                                    <div class="segment-title"
                                                         style="padding-bottom: 5px"><%- page.l.comments %></div>
                                                    <ul class="clearfix">
                                                        <% recent.forEach(function (comment) { %>
                                                            <li class="segment-poster-sm"
                                                                style="width:100%;padding:6.66px 10px">
                                                                <div class="poster poster-xs">
                                                                    <a href="<%- comment.url %>">
                                                                        <div class="poster-subject">
                                                                            <h2 class="truncate"><%= comment.title %></h2>
                                                                            <p class="poster-meta"
                                                                               style="display: inline-block; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                                                                                <%- comment.comment %>
                                                                            </p>
                                                                        </div>
                                                                        <img class="lazy-wide"
                                                                             src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAQAAACRI2S5AAAAEElEQVR42mNkIAAYRxWAAQAG9gAKqv6+AwAAAABJRU5ErkJggg=="
                                                                             alt="Avatar"
                                                                             data-src="<%- comment.avatar %>">
                                                                    </a>
                                                                </div>
                                                            </li>
                                                        <% }); %>
                                                    </ul>
                                                </div>
                                            </div>
                                        <% } %>
                                        <% } %>

                                    </div>

                                <% }); %>
                            <% } %>
                        <% } %>
                    <% } %>

                    <% /* Пагинация */ %>
                    <%- include('includes/pagination.ejs'); -%>

                    <% /* Блок с новостями */ %>
                    <% if (typeof news === 'object' && news.length) { %>
                        <div class="dark-segment collection-list">
                            <div class="segment-title pb-5 pt-5"><%- page.l.news %></div>
                            <ul class="clearfix">
                                <% news.forEach(function (content) { %>
                                    <li class="segment-poster-sm">
                                        <div class="poster poster-sm">
                                            <a href="<%- content.url %>">
                                                <span class="date"></span>
                                                <div class="poster-subject">
                                                    <p class="poster-meta">
                                                        <span class="episode-no"><%- content.publish %></span>
                                                    </p>
                                                    <h2><%- content.title %></h2>
                                                </div>
                                                <img alt="<%= content.title %>" class="lazy-wide"
                                                     src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAQAAACRI2S5AAAAEElEQVR42mNkIAAYRxWAAQAG9gAKqv6+AwAAAABJRU5ErkJggg=="
                                                     data-src="<%- content.image %>">
                                            </a>
                                        </div>
                                    </li>
                                <% }); %>
                            </ul>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="container">
            <div class="copyright">
                <% /* H1 тег */ %>
                <h1><%- page.h1 %></h1>

                <% /* Описание сайта */ %>
                <% if (page.seo) { %>
                    <div style="text-align:justify;margin:10px auto">
                        <%- page.seo %>
                    </div>
                <% } %>
            </div>
        </div>
        <%- include('includes/footer.ejs'); -%>
    </footer>
</main>
</body>

</html>